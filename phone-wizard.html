<!DOCTYPE html>
<html>
  <head>
    <meta name="title" content="JTech - Jewish Tech & Filtering Forum" />
    <meta
      name="description"
      content="JTech's mission is to empower the Jewish community with the most precise, accurate, and up-to-date tech and filtering information."
    />
    <meta name="keywords" content="jtech,jewish,tech,filter,egate,forum,apps4flip,flip phone,flip,phone,qin,f21,kosher" />
    <meta name="robots" content="index, follow" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="English" />
    <meta name="author" content="doniel@mesnan.com" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      img {
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div id="header-container"></div>

       <div class="bg-white px-6 py-26 mt-16 lg:px-8">
      <div class="mx-auto max-w-2xl text-center">
        <p class="text-base/7 font-semibold text-indigo-600">Community Resource</p>
        <h2 class="mt-2 text-5xl font-semibold tracking-tight text-gray-900 sm:text-7xl">Phone Wizard</h2>
        <p class="mt-8 text-lg font-medium text-pretty text-gray-500 sm:text-xl/8">
          Take the quiz and find out which app is best for you.
        </p>
        <br />
        <span class="text-gray-500 text-pretty underline text-lg">Please note the following about all the phones listed below:</span>
        <br />
        <ul class="text-gray-500">
          <li>• Most phones are not Kosher and contain open internet access.</li>
          <li>• We are not responsible for any damage or issues any phones listed cause.</li>
          <li>• Only phones that have been able to be filtered before are on this list.</li>
          <li>• Please verify any information on this page before relying on it for anything.</li>
        </ul>
      </div>
      
    <div class="max-w-3xl mx-auto py-16 px-4">
      <div id="wizard-container" class="bg-white shadow rounded-xl p-6 space-y-6"></div>
      <div class="flex justify-between mt-6">
        <button id="back-button" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 hidden">Back</button>
        <button id="next-button" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700">Next</button>
      </div>
    </div>

    <script>
      const steps = [
        { key: "price", label: "What is your maximum budget for a new phone?", type: "range", min: 0, max: 1000, step: 25 },
        { key: "refurbished", label: "What is your maximum budget for a refurbished phone?", type: "range", min: 0, max: 1000, step: 25 },
        { key: "brand", label: "Which phone brand do you prefer?", type: "multi-select" },
        { key: "region", label: "Which region will you use the phone in?", type: "multi-select" },
        { key: "appsCanBeInstalled", label: "What kind of apps can be installed?", type: "multi-select" },
        { key: "messaging", label: "What type of messaging do you need?", type: "multi-select" },
        { key: "adb", label: "Do you need ADB access?", type: "boolean" },
        { key: "type", label: "What type of phone are you looking for?", type: "multi-select" },
        { key: "comesFiltered", label: "Should the phone come filtered (kosher)?", type: "boolean" },
        { key: "carriers", label: "Which cellular carrier(s) do you need support for?", type: "multi-select" },
        { key: "network", label: "What type of network should the phone support?", type: "multi-select" },
        { key: "deviceFeatures", label: "Select required device features:", type: "multi-select" },
      ];

      let phones = [];
      let currentStep = 0;
      const userAnswers = {};

      window.onload = async function () {
        const res = await fetch("https://script.google.com/macros/s/AKfycbzQUjdGl3yBfaAt6zBRHd7yArNqutb1Pb481ghmc2c06Hw-qDjSRp1vMO6fJ9idG298tQ/exec");
        phones = await res.json();
        renderStep(currentStep);
      };

      function renderStep(stepIndex) {
        const container = document.getElementById("wizard-container");
        const step = steps[stepIndex];
        container.innerHTML = `<h2 class="text-2xl font-semibold mb-4">${step.label}</h2>`;

        const inputArea = document.createElement("div");
        inputArea.className = "space-y-3";

        if (step.type === "boolean") {
          ["Yes", "No"].forEach((val) => {
            const btn = document.createElement("button");
            btn.textContent = val;
            btn.className = "bg-indigo-600 text-white px-4 py-2 rounded mr-4 hover:bg-indigo-700";
            btn.onclick = () => {
              userAnswers[step.key] = val === "Yes";
              document.getElementById("next-button").click();
            };
            inputArea.appendChild(btn);
          });
        } else if (step.type === "range") {
          const label = document.createElement("div");
          label.id = "range-label";
          label.className = "text-sm mb-2";
          label.textContent = "$" + step.max;
          inputArea.appendChild(label);

          const input = document.createElement("input");
          input.type = "range";
          input.min = step.min;
          input.max = step.max;
          input.step = step.step;
          input.value = step.max;
          input.className = "w-full";
          input.oninput = (e) => (label.textContent = "$" + e.target.value);
          input.onchange = (e) => (userAnswers[step.key] = parseInt(e.target.value));
          inputArea.appendChild(input);
        } else if (step.type === "multi-select") {
          const options = [
            ...new Set(
              phones.flatMap((p) => {
                const val = p[step.key];
                return Array.isArray(val) ? val : [val];
              })
            ),
          ].filter(Boolean);

          options.forEach((opt) => {
            const btn = document.createElement("button");
            btn.textContent = opt;
            btn.className = "bg-indigo-100 text-indigo-800 px-3 py-1 rounded mr-2 mt-2 border hover:bg-indigo-200";
            btn.onclick = () => {
              userAnswers[step.key] = userAnswers[step.key] || [];
              const idx = userAnswers[step.key].indexOf(opt);
              if (idx === -1) {
                userAnswers[step.key].push(opt);
                btn.classList.add("bg-indigo-600", "text-white");
              } else {
                userAnswers[step.key].splice(idx, 1);
                btn.classList.remove("bg-indigo-600", "text-white");
              }
            };
            inputArea.appendChild(btn);
          });
        }

        container.appendChild(inputArea);
        document.getElementById("back-button").style.display = stepIndex > 0 ? "inline-block" : "none";
      }

      document.getElementById("next-button").onclick = () => {
        if (currentStep < steps.length - 1) {
          currentStep++;
          renderStep(currentStep);
        } else {
          showResults();
        }
      };

      document.getElementById("back-button").onclick = () => {
        if (currentStep > 0) {
          currentStep--;
          renderStep(currentStep);
        }
      };

      function showResults() {
        const container = document.getElementById("wizard-container");
        container.innerHTML = "<h2 class='text-2xl font-bold mb-4'>Your Matches</h2>";

        const summary = document.createElement("div");
        summary.className = "mb-6 text-sm text-gray-700 space-y-1";
        for (const [key, value] of Object.entries(userAnswers)) {
          const p = document.createElement("p");
          p.innerHTML = `<strong>${key}:</strong> ${Array.isArray(value) ? value.join(", ") : value}`;
          summary.appendChild(p);
        }
        container.appendChild(summary);

        const exactMatches = phones.filter((phone) => matches(phone, userAnswers));
        const nearMatches = phones
          .filter((phone) => !matches(phone, userAnswers))
          .map((phone) => ({ phone, diff: countDifferences(phone, userAnswers) }))
          .filter((entry) => entry.diff <= 2)
          .sort((a, b) => a.diff - b.diff)
          .slice(0, 8)
          .map((entry) => entry.phone);

        renderPhoneList("Exact Matches", exactMatches, container);
        renderPhoneList("Related Suggestions (1–2 filters off)", nearMatches, container);

        document.getElementById("next-button").style.display = "none";
        document.getElementById("back-button").textContent = "Restart";
        document.getElementById("back-button").onclick = () => location.reload();
      }
      function matches(phone, filters) {
        return Object.entries(filters).every(([key, val]) => {
          const phoneVal = phone[key];
          if (Array.isArray(val)) return val.some((v) => (Array.isArray(phoneVal) ? phoneVal.includes(v) : phoneVal === v));
          if (typeof val === "boolean") return phoneVal === val;
          return phoneVal <= val;
        });
      }

      function countDifferences(phone, filters) {
        return Object.entries(filters).reduce((diffs, [key, val]) => {
          const phoneVal = phone[key];
          if (Array.isArray(val)) {
            const phoneArr = Array.isArray(phoneVal) ? phoneVal : [phoneVal];
            if (!val.some((v) => phoneArr.includes(v))) return diffs + 1;
          } else if (typeof val === "boolean" && phoneVal !== val) {
            return diffs + 1;
          } else if (typeof val === "number" && phoneVal > val) {
            return diffs + 1;
          }
          return diffs;
        }, 0);
      }

      function renderPhoneList(title, phonesArr, container) {
        const section = document.createElement("div");
        section.innerHTML = `<h3 class="text-xl font-semibold mb-2 mt-6">${title} (${phonesArr.length})</h3>`;
        const grid = document.createElement("div");
        grid.className = "grid grid-cols-1 sm:grid-cols-2 gap-4";
        phonesArr.forEach((phone) => {
          const div = document.createElement("div");
          div.className = "border p-4 rounded bg-white shadow";
          div.innerHTML = `
      <h4 class="text-lg font-bold mb-1">${phone.name}</h4>
      <img src="${phone.image}" alt="${phone.name}" class="h-32 object-contain mb-2">
      <p><strong>New:</strong> $${phone.price}</p>
      <p><strong>Refurb:</strong> $${phone.refurbished}</p>
    `;
          grid.appendChild(div);
        });
        section.appendChild(grid);
        container.appendChild(section);
      }
    </script>

    <script type="module" src="https://unpkg.com/@material-tailwind/html@latest/scripts/tooltip.js"></script>

    <div id="footer-container"></div>

    <script>
      fetch("/constants/footer.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("footer-container").innerHTML = data;
        });

      fetch("/constants/headerLight.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("header-container").innerHTML = data;
        });
    </script>

    <style>
      .slide-up {
        transform: translateY(100%);
        opacity: 0;
        transition: transform 0.5s ease, opacity 0.5s ease;
      }

      .slide-up.show {
        transform: translateY(0);
        opacity: 1;
      }
    </style>
    <!-- START Formbricks Surveys -->
    <script type="text/javascript">
      !(function () {
        var t = document.createElement("script");
        (t.type = "text/javascript"),
          (t.async = !0),
          (t.src = "https://forms.mesnan.com/js/formbricks.umd.cjs"),
          (t.onload = function () {
            window.formbricks
              ? window.formbricks.setup({ environmentId: "cmad2of5l0009qa015j0l7n8y", appUrl: "https://forms.mesnan.com" })
              : console.error("Formbricks library failed to load properly. The formbricks object is not available.");
          });
        var e = document.getElementsByTagName("script")[0];
        e.parentNode.insertBefore(t, e);
      })();
    </script>
    <!-- END Formbricks Surveys -->
  </body>
</html>
